<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Portal Login</title>
<link href="https://fonts.googleapis.com/css2?family=UnifrakturCook&display=swap" rel="stylesheet">
<style>
body { font-family: Arial, sans-serif; margin:10px; background:#000; color:#0f0; }
h1 { color:#0f0; text-align:center; font-family:'UnifrakturCook', cursive; }
input { background:#111; color:#0f0; border:1px solid #0f0; margin-top:4px; }
button { margin-top:4px; }
</style>
</head>
<body>
<h1>Portal Login</h1>
<input type="password" id="passkey" placeholder="passkey">
<button onclick="submitPasskey()">Login</button>
<button onclick="logout()">Logout</button>
<div id="login-error" style="color:red;margin-top:4px;"></div>
<script>
async function submitPasskey(){
  const key=document.getElementById('passkey').value.trim();
  if(!key) return;
  const res=await fetch('/login',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({passkey:key})});
  if(res.ok){
    const data=await res.json();
    document.cookie=`session=${data.cookie}; path=/`;
    location.href='/portal';
  }else{
    document.getElementById('login-error').textContent='Invalid passkey';
  }
}

function logout(){
  const m=document.cookie.match(/(?:^|; )session=([^;]+)/);
  if(m){
    fetch('/logout',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({token:m[1]})});
  }
  document.cookie='session=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT';
  location.reload();
}
</script>
</body>
</html>
